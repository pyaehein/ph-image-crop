!function(e){e.fn.phImageCrop=function(a){var t=e.extend({defaultImage:"",name:"ph_images[]",fileName:"",type:"base64",cropper:{aspectRatio:1,minCropBoxWidth:1,minCropBoxHeight:1}},a);return this.each(function(){"undefined"!=typeof window.phImageIndex?window.phImageIndex=window.phImageIndex+1:window.phImageIndex=0;var a=window.phImageIndex,i='<div class="ph-img-thumbnail" style="padding-bottom: 10px"><img style="padding: 4px; border: 1px solid #ddd; border-radius: 4px;" class="old-thumbnail" id="ph-old-'+a+'" src="'+t.defaultImage+'"><img style="padding: 4px; border: 1px solid #ddd; border-radius: 4px; display: none" class="ph-thumbnail" id="ph-thumb-'+a+'"><img style="display: none" class="base-thumbnail" id="ph-base-'+a+'"><input class="ph-image" id="ph-image-'+a+'" type="hidden" name="'+t.name+'"></div><div><label class="btn btn-default"><span class="select-image" id="select-image-'+a+'">Select an image</span><span style="display: none" class="change-image" id="change-image-'+a+'">Change</span><input style="display: none" class="image-file" id="ph-image-file-'+a+'" '+(""!==t.fileName?'name="'+t.fileName+'" ':"")+'type="file" accept="image/*"></label><button style="display: none" id="crop-button-'+a+'" class="btn btn-default crop-button">Crop</button><button style="display: none" id="remove-button-'+a+'" class="btn btn-default remove-button">Remove</button></div>';e(this).addClass("ph-image-crop").attr("id","ph-image-crop-"+a).attr("data-ratio",t.cropper.aspectRatio).attr("data-width",t.cropper.minCropBoxWidth).attr("data-height",t.cropper.minCropBoxHeight).attr("data-type",t.type),e(this).html(i),e("#remove-button-"+a).on("click",function(){e("#ph-image-file-"+a).val(""),e("#ph-thumb-"+a).attr("src",""),e("#ph-thumb-"+a).hide(),e(this).hide(),e(this).parent().removeClass("btn-group"),e("#ph-old-"+a).show(),e("#select-image-"+a).show(),e("#change-image-"+a).hide(),e("#crop-button-"+a).hide()}),e("#ph-thumb-"+a).on("load",function(){e("#ph-old-"+a).hide(),e(this).show()}),e("#crop-button-"+a).on("click",function(){e("#crop-image").attr("src",e("#ph-base-"+a).attr("src")),window.phImageCropIndex=a,e("#ph-image-crop-modal").modal("show")}),e("#ph-image-file-"+a).on("change",function(){var t=e(this);t.parent().parent().addClass("btn-group"),e("#change-image-"+a).show(),e("#select-image-"+a).hide(),e("#crop-button-"+a).show(),e("#remove-button-"+a).show();var i=t[0].files[0],o=new FileReader;o.addEventListener("load",function(){e("#crop-image").attr("src",o.result),e("#ph-base-"+a).attr("src",o.result)},!1),i&&o.readAsDataURL(i),window.phImageCropIndex=a,e("#ph-image-crop-modal").modal("show")}),0===window.phImageIndex&&e("#ph-image-crop-modal").on("shown.bs.modal",function(){var a=e("#ph-image-crop-"+window.phImageCropIndex);e("#crop-image").cropper({aspectRatio:a.attr("data-ratio"),minCropBoxWidth:a.attr("data-width"),minCropBoxHeight:a.attr("data-height")})}).on("hidden.bs.modal",function(){var a=e("#crop-image").cropper("getCroppedCanvas",{fillColor:"#fff"}).toDataURL("image/jpeg");e("#ph-thumb-"+window.phImageCropIndex).attr("src",a),"canvas"===t.type?e("#ph-image-"+window.phImageCropIndex).val(e("#crop-image").cropper("getCropBoxData ")):"base64"===t.type&&(e("#ph-image-"+window.phImageCropIndex).val(a),e("#ph-image-file-"+window.phImageCropIndex).val("")),e("#crop-image").cropper("destroy")})})}}(jQuery);